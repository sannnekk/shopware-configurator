{% block hmnet_product_configurator %}
	{% set currencyDecimals = context.currency.itemRounding.decimals ?? 2 %}
	{% set taxRate = product.tax ? product.tax.taxRate : 0 %}
	{% set taxState = context.taxState %}


	{% if taxState != 'net' %}
		<div class="hmnet-product-configurator__tax-warning">
			<h3>Nicht unterstützt</h3>
			<p>Der Produktkonfigurator unterstützt nur Netto-Preise. Bitte wechseln Sie den Steuerstatus Ihres Shops auf "Netto" um den Konfigurator zu verwenden.</p>
		</div>
	{% else %}
		<div class="hmnet-product-configurator" data-hmnet-product-configurator data-currency-decimals="{{ currencyDecimals }}" data-tax-rate="{{ taxRate }}" data-fields='{{ page.extensions.hmnetConfiguratorFields|default([])|json_encode }}'>
			<h1 class="hmnet-product-configurator__title">
				{{ product.translated.name }}
			</h1>
			{% if product.translated.metaDescription %}
				<p class="hmnet-product-configurator__description">
					{{ product.translated.metaDescription }}
				</p>
			{% endif %}
			<div class="hmnet-product-configurator__fields">
				{% for field in page.extensions.hmnetConfiguratorFields|default([]) %}
					{% if not field.isVisible %}
						{% continue %}
					{% endif %}
					{% set defaultLabel = 'Bitte wählen' %}
					<div class="hmnet-product-configurator__field" data-hmnet-field data-field-id="{{ field.id }}" data-setup-price="{{ field.setupPrice|default(0) }}" data-film-price="{{ field.filmPrice|default(0) }}" data-options='{{ field.options|json_encode }}'>
						<div class="hmnet-product-configurator__field__head">
							<label class="hmnet-product-configurator__field__label" for="hmnet-configurator-field-{{ field.id }}">
								{{ field.translated.name }}
							</label>
							<select class="hmnet-product-configurator__field__options" id="hmnet-configurator-field-{{ field.id }}" data-hmnet-field-select>
								{% if not field.isRequired %}
									<option value="">
										{{ defaultLabel }}
									</option>
								{% endif %}
								{% for option in field.options %}
									{% for possibility in option.possibilities %}
										<option value="{{ possibility.id }}">
											{{ option.translated.name|default(option.name) }}
											{{ possibility.translated.name|default(possibility.name) }}
										</option>
									{% endfor %}
								{% endfor %}
							</select>
						</div>
						<div class="hmnet-product-configurator__field__item-price">
							<span class="odometer value" data-hmnet-field-unit-price>0,00</span>
							<span class="currency">{{ context.currency.symbol }}</span>
						</div>
						<div class="hmnet-product-configurator__field__amount">
							<span class="odometer value" data-hmnet-field-amount>0</span>
						</div>
						<div class="hmnet-product-configurator__field__item-total">
							<span class="odometer value" data-hmnet-field-unit-total>0,00</span>
							<span class="currency">{{ context.currency.symbol }}</span>
						</div>
					</div>
				{% endfor %}
			</div>
			<div class="hmnet-product-configurator__breakdown">
				<h3 class="hmnet-product-configurator__breakdown__title">Einrichtungs- und Filmkosten</h3>
				<ul class="hmnet-product-configurator__breakdown__list" data-hmnet-breakdown-list></ul>
			</div>
			<div class="hmnet-product-configurator__total">
				<div class="hmnet-product-configurator__total__net">
					<h3>Total net</h3>
					<span class="odometer value" data-hmnet-product-configurator-total-net>0,00</span>
					<span class="currency">{{ context.currency.symbol }}</span>
				</div>
				<div class="hmnet-product-configurator__total__tax">
					<h4>Total tax</h4>
					<span class="odometer value" data-hmnet-product-configurator-total-tax>0,00</span>
					<span class="currency">{{ context.currency.symbol }}</span>
				</div>
				<div class="hmnet-product-configurator__total__gross">
					<h4>Total gross</h4>
					<span class="odometer value" data-hmnet-product-configurator-total-gross>0,00</span>
					<span class="currency">{{ context.currency.symbol }}</span>
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}
